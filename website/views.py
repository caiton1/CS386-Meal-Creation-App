from flask import Flask, render_template, request, redirect, url_for, session
from firebase import firebase

testdict = {'2 Meat Meatloaf': {'Description': ['Dinner', 'American', 'High-Protien', 'Easy', 'Beef', 'Comfort'], 'Directions': ['Preheat oven to 350F.', 'Soften the bread crumbs in the milk for a few minutes, then pour off the excess milk.', 'Combine the 2 meats and mix well. Add all other ingredients and mix until thoroughly combined.', 'Place in large loaf pan, 2 smaller loaf pans or shape into loaf shape and bake on flat baking pan.', 'Bake for 1 hour at 350 or until browned and fully cooked inside.'], 'Ingredients': {'Bread crumbs': '1/2 cup, $1', 'Carrot': '1 shredded, $.90', 'Dijon mustard': '1 teaspoon, $1.30', 'Dried Thyme': '1/2 teaspoon, $1.70', 'Eggs': '2, $1.70', 'Garlic cloves': '2 minced, $.80', 'Ground beef': '1 1/2 pound, $7', 'Ground pork': '1/2 pound, $1.50', 'Onion': '1 chopped finely, $.70', 'Pepper': '1/2 teaspoon, $4', 'Salt': '1 teaspoon, $2'}, 'Rating': 3, 'Serving Size': 4}, 'Angel Hair with Lemon & Garlic': {'Description': ['Italian', 'Vegetarian', 'Quick', 'Easy', 'Cheap', 'Dinner'], 'Directions': ['Bring a large pot of salted water to a boil over high heat and maintain at a boil.', 'Put olive oil and garlic into a saute pan and cook garlic over medium heat until garlic begins to brown.', 'Remove the pan from the heat and pour in the wine. Return the pan to the heat and cook for 1 to 2 minutes, until wine is reduced by half.', 'Stir in lemon juice and chopped tomato. Remove the pan from the heat.', 'Place the pasta in boiling water and cook until desired tenderness.', 'Drain and place in a large serving bowl. Add the basil, Parmesan cheese, pepper and olive oil/ tomato mixture.', 'Toss and serve.'], 'Ingredients': {'Angel hair pasta': '8 ounces, $2', 'Basil': '1/4 cup, $2', 'Dry white wine': '1/2 cup, $4', 'Garlic cloves': '2 peeled and minced, $.80', 'Lemon juice': '1/4 cup squeezed, $2', 'Parmesan Cheese': '2 tablespoons, $3', 'Pepper': 'A pinch, $2', 'Teaspoon of olive oil': '1, $3', 'Tomato': '1 cup, $.90'}, 'Rating': 4, 'Serving Size': 2}, 'Baked Macaroni and Cheese': {'Description': ['Dinner', 'Appetizer', 'Comfort', 'American'], 'Directions': ['Preheat oven to 350F.', 'Cook macaroni in salted boiling water until almost soft (al dente). Drain well.', 'Grease a large shallow casserole and place a layer of macaroni on the bottom, sprinkle with cheese, butter, flour and seasonings.', 'Continue to layer until all ingredients are used evenly in the layers. (3 layers works well)', 'Pour milk over all. Top with buttered bread crumbs.', 'Bake at 350 for 40 minutes.'], 'Ingredients': {'Butter': '2 tablespoons, $2.30', 'Cheddar cheese': '1 1/2 cups, $4', 'Flour': '2 tablespoons, $2.50', 'Macaroni': '8 ounces, $1', 'Milk': '1 3/4 cups, $1.20', 'Pepper': '1/4 teaspoon, $1.50', 'Salt': '1/2 teaspoon, $2', 'Soft Bread Crumbs': '2/3 cups, $1'}, 'Rating': 5, 'Serving Size': 6}, 'Chinese Beef and Broccoli': {'Description': ['Chinese', 'Easy', 'High-Protien', 'Low-Carb', 'Beef', 'Dinner', 'Healthy'], 'Directions': ['Slice beef thinly across the grain. Add 1 tablespoon soy sauce and set aside to marinate while you get everything else ready.', 'Mix together the broth, soy sauce, cornstarch and ginger and set aside.', 'Spray a cold frying pan or wok with non-stick spray and heat to mid high heat.', 'Add broccoli, mushrooms, red pepper and green onions. Cook, stirring at all times, for 3 or 4 minutes.', 'Vegetables will be tender but still crisp. Remove vegetables from wok.', 'Add the oil to the wok, being careful as the pan is quite hot. Add beef slices and stir fry for 2 or 3 minutes until beef is just slightly pink in the center.', 'Push the beef away from the center of the pan.', 'Stir the sauce mixture again then add to the center of the pan.', 'Cook the sauce with the beef, stirring at all times, until the sauce thickens and bubbles.', 'Return the vegetables to the wok or pan. Stir all together until everything is well coated and heated through.'], 'Ingredients': {'Beef Broth': '1/2 cup, $.70', 'Broccoli': '2 cups, $1.50', 'Corn starch': '2 1/2 teaspoons, $1.70', 'Grated ginger': '1/2 teaspoon, $.90', 'Green Onions': '4 sliced, $.50', 'Lean Round Steak': '8 ounces, $6.50', 'Mushrooms': '1 1/2 cups sliced, $2', 'Peanut Oil': '1 tablespoon, $3', 'Red Pepper': '1 diced, $1.50', 'Soy Sauce': '1 ounce and 3 tablespoons, $1.60'}, 'Rating': 5, 'Serving Size': 4}, 'Chocolate Chip Cookies': {'Description': ['Dessert', 'Vegetarian', 'Comfort', 'Easy'], 'Directions': ['Preheat oven to 375F.', 'In a small bowl, combine the flour, baking soda and salt. Set aside for a minute.', 'In a large bowl, combine butter, white sugar, brown sugar, and vanilla. Beat until the mixture is creamy.', 'Beat in the eggs. Gradually add in the flour mixture. Stir in the chocolate chips.', 'Drop the cookie mixture by the tablespoonful on an ungreased cookie sheets.', 'Bake for 9-11 minutes, until golden brown.'], 'Ingredients': {'Baking Soda': '1 teaspoon, $.90', 'Brown sugar': '3/4 cup, $2.30', 'Butter': '1 cup softened, $1.50', 'Eggs': '2, $1.70', 'Flour': '2 1/4 cups, $2.50', 'Salt': '1 teaspoon, $1', 'Semi-sweet chocolate chips': '2 cups, $2', 'Vanilla extract': '1 teaspoon, $1.50', 'White sugar': '3/4 cup, $3'}, 'Rating': 4, 'Serving Size': 36}, 'Easy Bake Chicken Breast': {'Description': ['Italian', 'Easy', 'High-Protein', 'Low-Carb', 'Quick', 'Chicken', 'Dinner', 'Healthy'], 'Directions': ['Spray a glass casserole dish with non-stick spray. Use whatever size casserole fits the amount of chicken you are using.', 'Sprinkle each chicken breast with salt and pepper, garlic powder and onion powder. Place the chicken pieces in the baking dish.', 'Slice the tomatoes and lay a large slice or two small slices of tomato on each breast. Drizzle with a bit of olive oil.', 'Bake at 375F for about 20 minutes.', 'Sprinkle 1 tablespoon of Parmesan cheese on each chicken breast. Bake for another 5 minutes.'], 'Ingredients': {'Boneless Chicken Breast': '4, $4.50', 'Garlic Powder': '1 Tablespoon, $1', 'Olive Oil': '4 Teaspoons, $1', 'Onion Powder': '1 Tablespoon, $2', 'Parmesan Cheese': '1 ounce, $1.8', 'Pepper': '1 Tablespoon, $3', 'Salt': '1 Tablespoon, $3', 'Tomatoes': '2, $3'}, 'Rating': 4, 'Serving Size': 4}, 'Egg & Veggie Breakfast Burrito': {'Description': ['Breakfast', 'Quick', 'Easy', 'Healthy', 'Vegetarian', 'Low-Carb'], 'Directions': ['Heat a lightly greased skillet over medium heat until hot. Add the pepper, ham and onions.', 'Cook and stir for 3 minutes or until vegetables are tender crisp.', 'Add the eggs. Reduce the heat to low. Cook and stir for 3 minutes or until the eggs are set.', 'Warm the tortillas in the microwave for 1 minute on high. Place 1/4 of the egg mixture on each tortilla.', 'Sprinkle with the grated cheese and top with some chopped tomato and parsley if using.', 'Fold the sides to enclose the filling.'], 'Ingredients': {'Eggs': '8, $1.70', 'Flour tortillas': '4 large, $3', 'Green Onion': '5 sliced, $.50', 'Ham': '4 ounces, $2', 'Monterey jack cheese': '1/2 cup, $2.20', 'Parsley': '1 tablespoon, $.90', 'Red pepper': '1 chopped, $1.50', 'Salsa': '1/3 cup, $2', 'Tomato': '1/2 cup, $.90'}, 'Rating': 5, 'Serving Size': 4}, 'Potato Salad': {'Description': ['Gluten-Free', 'Appetizer', 'Easy', 'Vegetarian', 'Potato'], 'Directions': ['Boil potatoes whole, with the skins on, in salted water for about 15 to 20 minutes until they are tender in the middle when you prick with a fork.', 'Cool the potatoes a bit then peel them, cut into cubes and place in a large bowl.', 'In a separate smaller bowl combine the mayonnaise, mustard, celery seeds, salt and pepper. Mix well.', 'Add the chopped eggs, onion, celery and pickles and mix together to combine.', 'Pour dressing over the cubed potatoes and mix lightly so as not to break up the potatoes too much. Cover and chill until time to serve.'], 'Ingredients': {'Celery': '1/2 cup, $3', 'Celery Seeds': '1/2 teaspoon, $2', 'Hard Boiled Eggs': '2, $.70', 'Mayonnaise': '1 cup, $3', 'Mustard': '1 teaspoon, $1', 'Onion': '1/2 cup, $1.70', 'Pepper': '1/8 teaspoon, $1.70', 'Potatoes': '7, $5.60', 'Salt': '1/2 teaspoon, $2', 'Sweet pickles': '1/2 cup, $3'}, 'Rating': 4, 'Serving Size': 6}, 'Taco Soup': {'Description': ['Dinner', 'Healthy', 'Mexican', 'Beef', 'Low-Carb', 'Easy'], 'Directions': ['Brown ground beef with onion and garlic.', 'When well browned, add the remaining ingredients and simmer for 1 hour.'], 'Ingredients': {'Corn': '1 can, $1', 'Garlic': '1/2 teaspoon, $.80', 'Green chiles': '4 ounces, $1.50', 'Ground beef': '1 1/2 pound, $7', 'Kidney beans': '16 ounces, $1.30', 'Onion': '1 chopped, $.70', 'Pinto beans': '16 ounces, $1.30', 'Salsa': '2 cups, $2.30', 'Taco seasoing': '1 packet, $.60', 'Tomato sauce': '16 ounces, $1', 'Tomatoes': '16 ounces, $1', 'Water': '3 cups'}, 'Rating': 3, 'Serving Size': 8}, 'Veggie Quesadilla': {'Description': ['Dinner', 'Snack', 'Mexican', 'Vegetarian', 'Easy', 'Comfort'], 'Directions': ['In a large skillet, heat the oil over medium high heat.', 'Add the mushrooms, peppers and garlic. Cook, stirring constantly, for 1 to 2 minutes.', 'Add the spinach and corn and cook just until the spinach is wilted, 1 or 2 minutes.', 'Spread half of the mixture onto one tortilla, sprinkle with the chopped tomatoes and half of the cheese.', 'Place the second tortilla evenly over the mixture.', 'Melt the butter or oil in large skillet over medium high heat.', 'Place the quesadilla in the skillet and cook for 2 to 3 minutes on each side or until golden brown and the cheese is melted.', 'Repeat with the remaining ingredients.'], 'Ingredients': {'Butter': '2 teaspoons, $1.50', 'Cheddar Cheese': '1 cup, $2', 'Corn': '1/2 cup, $.60', 'Flour Tortillas': '4 large, $3', 'Garlic': '1 clove, $.80', 'Mushrooms': '1 cup sliced, $2', 'Red pepper': '1 cup of strips, $1.50', 'Salsa': '1/4 cup, $2', 'Spinach': '2 cups, $2', 'Tomato': '1 chopped, $.90', 'Vegtable oil': '1 tablespoon, $3'}, 'Rating': 4, 'Serving Size': 4}}

recipeList = {}

for key, value in testdict.items():
    recipeList.update({key:{
         "href":key.replace(" ", "+"),
         "caption":key
    }})

#print(recipeList["2 Meat Meatloaf"]["href"])

app = Flask(__name__)
firebase = firebase.FirebaseApplication('https://cspickmymeals-default-rtdb.firebaseio.com/', None)

# Defining the home page of our site
@app.route("/")  # this sets the route to this page
def index():
	return render_template('index.html')

@app.route('/results')  # this sets the route to this page
def results():
    result = firebase.get('/Recipe', None) # returns dictionary
    return str(result)

@app.route("/recipe", methods=["GET"])
def recipe():
    #result = firebase.get('/Recipes', None)
    return render_template('recipe.html', recipes=recipeList)

@app.route("/search", methods=["POST", "GET"])
def search():
    if request.method == "POST":
        searchRecipe = request.form["nm"]
        print(searchRecipe)
        #return redirect(url_for("searchRecipe", recipe=searchRecipe))
        return render_template("search.html")
    else:      
        return render_template("search.html")
    
@app.route("/recipe/<selection>")
def viewRecipe(selection):
     selection = selection.replace("+", " ")
     print("DEBUG: " + selection)
     data = testdict[selection]
     print(data)
     return render_template("selection.html", dataInput=data.items())

if __name__ == "__main__":
    app.run()